var MitoApiSDKError=function(a,b){this.name="MitoApiSDKError",this.message=a,this.cause=b};MitoApiSDKError.prototype=new Error,MitoApiSDKError.prototype.constructor=MitoApiSDKError;var MitoApiSDK=function(w){"use strict";var _apiUrl="http://api.mito.hu",_isCreated=!1,_options,_routes={phone:{bynumber:{params:["phonenumber"],path:"/api/{key}/phone/{phonenumber}"},withcountry:{params:["phonenumber","country"],path:"/api/{key}/phone/{country}/{phonenumber}"},search:{params:["country","firstname","lastname","city"],path:"/api/{key}/phone/search/{country}/{firstname}/{lastname}/{city}"}}},_checkEndpoint=function(a,b,c){if(b<a.length&&a[b]in c)return c=c[a[b]],b++,_checkEndpoint(a,b,c);if(b<a.length)throw new MitoApiSDKError("Unknown endpoint.",a);return c},_handleReadyState=function(o,callback,errorCallback){var poll=setInterval(function(){if(o&&4===o.readyState){if(w.clearInterval(poll),""===o.responseText)throw new MitoApiSDKError("It seems, the api hung down temporary.",o);if(eval("var data = "+o.responseText+";"),200==o.status){if("error"in data&&errorCallback)return errorCallback.call(o,data),void 0;callback&&callback.call(o,data)}else o.status>=400&&errorCallback&&errorCallback.call(o,data)}},50)},_getXHR=function(){var a;try{a=new XMLHttpRequest,_getXHR=function(){return new XMLHttpRequest}}catch(b){for(var c=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],d=0,e=c.length;e>d;++d)try{a=new ActiveXObject(c[d]),_getXHR=function(){return new ActiveXObject(c[d])};break}catch(b){}}return a},_buildUrl=function(a,b){var c=a.path,d=new RegExp("/{key}/g");if(d.test(c)&&!("key"in _options))throw new MitoApiSDKError("Access token is missing.",_options);var e;for(e in b)c=c.replace("{"+e+"}",w.encodeURIComponent(b[e]));return c=c.replace("{key}",_options.key),_apiUrl+c},_apiCall=function(a,b,c,d){var e=_getXHR();return e.open("GET",_buildUrl(a,b),!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),_handleReadyState(e,c,d),e.send(),e};return{init:function(a){if(_isCreated)throw new MitoApiSDKError("Only one instance is allowed.",this);_isCreated=!0,_options=a||{}},api:function(){if(!_isCreated)throw new MitoApiSDKError("MitoSDK is not initialized.",this);var a=Array.prototype.slice.call(arguments,0);if(a.length<3)throw new MitoApiSDKError("Unsupported call.",a);if("function"!=typeof a[2])throw new MitoApiSDKError("Callback is not a function");if(a[3]&&"function"!=typeof a[3])throw new MitoApiSDKError("ErrorCallback is not a function");var d,b="/"===a[0].substring(0,1)?a[0].substring(1).split("/"):a[0].split("/"),c=_checkEndpoint(b,0,_routes);for(d in c.params)if(!(c.params[d]in a[1]))throw new MitoApiSDKError("Missing parameter: "+c.params[d]+".",c.params);_apiCall(c,a[1],a[2],a[3])},getRoutes:function(){return _routes}}}(window);